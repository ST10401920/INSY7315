Chatbot

// import express, { Request, Response } from "express";
// import fetch from "node-fetch";


// const stringSimilarity = require("string-similarity");
// const router = express.Router();

// interface ChatIntent {
//   keywords: string[];          
//   regex?: RegExp;              
//   reply: string;               
// }

// const intents: ChatIntent[] = [
//   { keywords: ["hello", "hi", "hey"], reply: "Hi there! How can I help you today?" },
//   { keywords: ["how are you", "how's it going"], reply: "I'm just a bot, but I'm doing great!" },
//   { keywords: ["bye", "goodbye", "see you"], reply: "Goodbye! Have a nice day!" },
//   { keywords: ["help", "support"], reply: "Sure! What do you need help with?" },
//   { keywords: ["contact support", "reach support", "helpdesk"], reply: "You can contact support by clicking 'Help Center' in Settings or sending an email to support@nestify.com." },
//   { keywords: ["faq", "questions", "how does this work"], reply: "You can visit the FAQ section in Settings to find answers to common questions about renting, payments, and maintenance." },
//   { keywords: ["rent", "property", "apartment"], reply: "I can help you with property info and rentals." },
//   { keywords: ["send application", "submit application", "apply for property", "apply for rent"], reply: "To submit an application, go to the property page and click 'Rent'. Fill out your details and upload necessary documents." },
//   { keywords: ["application status", "check application", "view application", "application update"], reply: "You can view your application status under 'Application History' in Settings." },
//   { keywords: ["view lease", "lease details", "my lease", "rental agreement"], reply: "You can view your current lease by going to Settings, navigating to Application History and clicking 'View Lease'. Alternatively, from your dashboard click 'View Lease'." },
//   { keywords: ["end lease", "cancel lease", "terminate lease"], reply: "To request a lease termination, please contact support or reach out to your property manager through the app." },
//   { keywords: ["update profile", "edit profile", "change details", "update info"], reply: "To update your profile, go to Settings and click 'Edit Profile'." },
//   { keywords: ["change password", "reset password", "forgot password"], reply: "To reset your password, click 'Forgot Password' on the login screen or go to Settings > Account Security." },
//   { keywords: ["account issue", "login issue", "cant login"], reply: "If you're having trouble logging in, ensure your credentials are correct or reset your password. Contact support if the problem continues." },
//   { keywords: ["pay rent", "payment", "rent payment", "make payment"], reply: "You can pay your rent via 'Payments' in your dashboard. Choose your preferred payment method and follow the instructions." },
//   { keywords: ["payment history", "previous payments", "view transactions"], reply: "You can see your payment history under 'Payments' in your dashboard." },
//   { keywords: ["late payment", "payment failed", "rent not going through"], reply: "If your payment failed, check your network connection and card details. You can also try another payment method." },
//   { keywords: ["maintainance support", "log maintainance request", "log maintainance", "property issues", "i got property issues"], reply: "I can help you log a new maintenance request. Go to your dashboard or settings and select 'Log Maintenance Request'." },
//   { keywords: ["caretaker", "request caretaker", "call caretaker"], reply: "You can contact your assigned caretaker through the 'Property Details' section or 'Maintenance Support' in your dashboard." },
//   { keywords: ["notifications", "alerts", "updates"], reply: "You can manage your notifications in Settings under 'Notification Preferences'." },
//   { keywords: ["turn off notifications", "disable alerts"], reply: "To turn off notifications, go to Settings > Notifications and toggle off the alerts you don't want to receive." },
//   { keywords: ["upload document", "submit document", "id proof", "proof of income"], reply: "To upload documents, go to your application form or profile and select 'Upload Documents'." },
//   { keywords: ["view documents", "download lease", "download invoice"], reply: "You can view or download your documents in Settings under 'My Documents'." },
//   { keywords: ["dashboard", "home screen", "main menu"], reply: "You can access your dashboard from the bottom navigation bar. It gives you quick access to leases, payments, and maintenance." },
//   { keywords: ["settings", "account settings"], reply: "You can find account settings in the top-right menu or the sidebar of your dashboard." },
//   { keywords: ["what are you", "who are you", "what is your purpose"], reply: "I’m your personal Nestify AI assistant! I can help you navigate the app, log maintenance requests, view leases, and more." },
//   { keywords: ["thank you", "thanks"], reply: "You're welcome! Happy to help." },
//   { keywords: ["app not working", "error", "bug", "crash"], reply: "Try restarting the app or checking your internet connection. If the problem continues, contact support through the Help Center." },
//   { keywords: ["location", "address"], reply: "You can update or view your property address in the 'My Properties' section." },
//   { keywords: ["Should we call Rikishi... Rikishi"], reply: "Yes you should"}
// ];

// const getReply = (message: string): string => {
//   const normalized = message.toLowerCase().trim();

//   for (const intent of intents) {
//     if (intent.keywords.some(keyword => normalized.includes(keyword.toLowerCase().trim()))) {
//       return intent.reply;
//     }
//   }

//   let bestMatch = { rating: 0, reply: "" };
//   for (const intent of intents) {
//     for (const keyword of intent.keywords) {
//       const similarity = stringSimilarity.compareTwoStrings(normalized, keyword.toLowerCase().trim());
//       if (similarity > 0.7 && similarity > bestMatch.rating) {
//         bestMatch = { rating: similarity, reply: intent.reply };
//       }
//     }
//   }

//   return bestMatch.reply || "Sorry, I didn't understand that. Can you rephrase?";
// };


// let userContext: Record<string, string> = {};

// router.post("/", (req: Request, res: Response) => {
//   const { message, userId } = req.body;
//   if (!message) return res.status(400).json({ error: "Message is required" });

//   const reply = getReply(message);

//   if (userId) userContext[userId] = message;

//   res.json({ reply });
// });


// export default router;















// // const API_KEY = "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";
// // const MODEL = "deepseek/deepseek-r1:free";

// // router.post("/", async (req: Request, res: Response) => {
// //   try {
// //     const userMessage = req.body.message;
// //     console.log("User message:", userMessage);

// //     const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
// //       method: "POST",
// //       headers: {
// //         "Authorization": `Bearer ${API_KEY}`,
// //         "Content-Type": "application/json",
// //       },
// //       body: JSON.stringify({
// //         model: MODEL,
// //         messages: [
// //           { role: "system", content: "You are a helpful property management assistant for Nestify. Keep answers short and clear." },
// //           { role: "user", content: userMessage }
// //         ],
// //       }),
// //     });

// //     const data = await response.json();
// //     console.log("OpenRouter raw response:", JSON.stringify(data, null, 2));

// //     const botMessage = data.choices?.[0]?.message?.content || "Sorry, I didn’t understand.";
// //     console.log("Bot reply:", botMessage);

// //     res.json({ reply: botMessage });
// //   } catch (err) {
// //     console.error("Chatbot error:", err);
// //     res.status(500).json({ reply: "Something went wrong." });
// //   }
// // });

// // export default router;